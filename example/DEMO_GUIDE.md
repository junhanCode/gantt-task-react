# Demo 应用使用说明

本demo应用展示了甘特图组件的所有功能，包括最新添加的三个新功能。

## 🚀 启动 Demo

```bash
# 1. 构建主项目
cd d:\code\gantee\gantt-task-react
npm run build

# 2. 启动demo应用
cd example
npm install  # 首次运行需要安装依赖
npm start    # 启动开发服务器
```

应用会在 `http://localhost:3000` 启动。

---

## ✨ 新功能展示

### 1. 自定义复选框边框颜色

**位置**: "✅ 多选列功能演示 + ✨ 新功能" 区域

**如何使用**:
1. 确保"显示多选列"复选框已勾选
2. 点击"复选框颜色"旁的颜色选择器
3. 选择你喜欢的颜色
4. 查看任务列表左侧的复选框颜色变化

**推荐颜色**:
- `#1890ff` - 蓝色（默认）
- `#52c41a` - 绿色
- `#fa8c16` - 橙色
- `#f5222d` - 红色
- `#722ed1` - 紫色

**效果**:
- 复选框会使用你选择的颜色
- 包括表头的全选复选框和每行的复选框
- 选中状态也会显示该颜色

---

### 2. 时间自动规范化

**自动生效，无需配置！**

**如何验证**:

**方式1 - 查看现有任务**:
1. 观察甘特图中的任务条形图
2. 所有任务都会占据完整的格子宽度
3. 即使任务的开始和结束是同一天的不同时间点

**方式2 - 创建新任务**:
1. 点击任意任务的"新增子任务"按钮
2. 设置开始和结束时间为同一天，例如：
   - 开始：2024-01-15 14:30
   - 结束：2024-01-15 16:45
3. 保存任务
4. 观察甘特图中的条形图 - 它会占据完整的一天（从00:00到23:59）

**技术细节**:
- 开始时间会自动设为 `00:00:00`
- 结束时间会自动设为 `23:59:59`
- 这确保了视觉上的一致性和完整性

---

### 3. 任务标题自定义按钮

**位置**: "✅ 多选列功能演示 + ✨ 新功能" 区域

**如何使用**:

**步骤1 - 启用功能**:
1. 勾选"显示任务标题按钮 ℹ️"复选框

**步骤2 - 点击按钮**:
1. 在任务列表中，查看每个任务名称的右侧
2. 会看到一个蓝色的 ℹ️ 信息图标
3. 点击该图标

**步骤3 - 查看效果**:
- 会弹出一个模态框
- 显示该任务的详细信息：
  - 任务名称、ID、类型
  - 状态、负责人、进度
  - 开始/结束时间
  - 计划时间、实际时间（如有）

**自定义说明**:
在实际应用中，你可以将这个按钮连接到：
- API 调用（获取更多任务详情）
- 编辑弹窗
- 任务历史记录
- 评论/附件列表
- 任何你需要的操作！

---

## 📊 完整功能清单

### 基础功能

#### 视图模式
- 日视图 / 月视图 / 季视图切换
- 时间轴缩放控制

#### 任务操作
- ✅ 新增子任务（点击"新增子任务"按钮）
- ✅ 编辑任务（点击"编辑"按钮）
- ✅ 删除任务（支持单个删除和批量删除）
- ✅ 拖动调整时间（需启用"允许拖动任务"）
- ✅ 拉伸调整时间（需启用"允许拉伸调整时间"）
- ✅ 双击查看详情

#### 任务展示
- 展开/折叠任务树
- 自定义展开/折叠图标（▶ / ▼）
- 进度条显示
- 状态颜色标识
- 负责人显示

#### 多选功能
- 全选/取消全选
- 级联选择（选中父任务自动选中子任务）
- 批量删除
- 显示选中数量

### 高级功能

#### 样式自定义
- 任务名列宽度调整
- 复选框颜色自定义（✨ 新）
- 表格样式配置
- 条形图颜色配置

#### 交互增强
- 任务标题自定义按钮（✨ 新）
- 自定义列渲染
- 溢出文本处理
- 拖动权限控制

#### 性能优化
- 大数据量测试（可配置父任务数和子任务数）
- 空数组测试
- 虚拟滚动支持

---

## 🎯 测试场景

### 场景1: 测试复选框颜色

```
1. 勾选"显示多选列"
2. 选择不同颜色
3. 勾选几个任务
4. 观察选中效果
5. 点击全选
6. 观察表头复选框颜色
```

### 场景2: 测试时间规范化

```
1. 点击任意任务的"新增子任务"
2. 填写任务信息：
   - 名称：测试任务
   - 类型：task
   - 时间：同一天的不同时间（如 14:30-16:45）
3. 保存
4. 观察甘特图中的条形图
   预期：占据完整的格子，而不是部分
```

### 场景3: 测试任务标题按钮

```
1. 勾选"显示任务标题按钮 ℹ️"
2. 找到任意任务
3. 点击任务名称旁的 ℹ️ 图标
4. 查看弹出的任务详情
5. 尝试点击不同任务的按钮
```

### 场景4: 综合测试

```
1. 设置复选框颜色为绿色
2. 启用任务标题按钮
3. 选中几个任务（观察绿色复选框）
4. 点击其中一个任务的 ℹ️ 按钮查看详情
5. 创建一个新任务（时间为同一天）
6. 观察新任务在甘特图中的显示
```

---

## 🐛 故障排查

### 问题1: 复选框颜色没有变化

**可能原因**: 浏览器不支持 `accent-color` 属性

**解决方案**:
- 升级浏览器到最新版本
- 使用 Chrome 93+, Firefox 93+, Safari 15.4+, Edge 93+

---

### 问题2: 任务标题按钮不显示

**检查清单**:
- ✅ 是否勾选了"显示任务标题按钮 ℹ️"
- ✅ 视图模式是否为 "oaTask"（当前demo固定为oaTask）
- ✅ 刷新页面重试

---

### 问题3: 时间显示异常

**说明**: 时间规范化是自动的，会影响所有任务

**验证方法**:
1. 打开浏览器开发者工具（F12）
2. 在 Console 中输入：
   ```javascript
   // 查看任务数据
   console.log(tasks);
   ```
3. 检查任务的 start 和 end 时间是否已规范化

---

## 💡 开发提示

### 如何修改代码测试

**修改复选框颜色**:
```tsx
// 在 App.tsx 中找到
const [checkboxBorderColor, setCheckboxBorderColor] = useState('#1890ff');

// 修改默认颜色
const [checkboxBorderColor, setCheckboxBorderColor] = useState('#52c41a'); // 绿色
```

**修改任务标题按钮行为**:
```tsx
// 在 App.tsx 的 Gantt 组件中找到 onTaskTitleAction
onTaskTitleAction={(task) => {
  // 替换为你的自定义逻辑
  console.log('点击了任务:', task);
  
  // 例如：调用API
  // fetch(`/api/tasks/${task.id}`)
  //   .then(res => res.json())
  //   .then(data => console.log(data));
}}
```

**禁用时间规范化**（如需测试）:
```tsx
// 时间规范化在库内部自动执行
// 如需禁用，需要修改 src/helpers/bar-helper.ts
// 将 normalizeTimeForSameDay 函数修改为直接返回原始时间
```

---

## 📚 相关文档

- [快速参考](../QUICK_REFERENCE.md)
- [功能更新详解](../FEATURE_UPDATES.md)
- [使用示例](../example/USAGE_EXAMPLES.md)
- [实现总结](../IMPLEMENTATION_SUMMARY.md)

---

## 🎉 开始体验

现在你可以启动demo应用，体验这些新功能了！

```bash
cd example
npm start
```

享受编码的乐趣！✨
