# 性能测试数据生成功能 - 更新说明

## 概述

为了方便进行性能优化和压力测试，已在示例应用中添加了大量假数据生成功能。

## 主要改动

### 1. 新增功能 (`example/src/helper.tsx`)

#### `generateLargeMockData()` 函数
```typescript
generateLargeMockData(
  parentCount: number = 100,        // 父任务数量
  childrenPerParent: number = 10    // 每个父任务的子任务数量
): MockTask[]
```

**功能特点：**
- 自动生成指定数量的父任务和子任务
- 随机生成真实的任务属性（状态、优先级、时间、负责人等）
- 时间范围跨越过去30天到未来30天
- 根据任务状态自动计算合理的进度和完成时间
- 支持各种任务状态：待确认、处理中、待验收、已完成、挂起中

#### 更新的 `initTasks()` 函数
```typescript
initTasks(
  useLargeData: boolean = false,    // 是否使用大数据模式
  parentCount: number = 100,         // 父任务数
  childrenPerParent: number = 10     // 子任务数
): Task[]
```

### 2. 用户界面更新 (`example/src/App.tsx`)

#### 新增性能测试控制面板
- 勾选框：启用/禁用大数据模式
- 输入框：配置父任务数量（1-1000）
- 输入框：配置子任务数量（0-50）
- 显示：实时显示当前任务总数和计算的总任务数
- 按钮：重新加载数据并计时

**界面预览：**
```
🚀 性能测试数据配置 (当前任务数: 1100)
☑ 使用大量测试数据  
父任务数: [100]  
每个父任务的子任务数: [10]  
= 1100 个任务  
[重新加载数据]
```

## 使用方法

### 快速开始

1. 启动示例应用：
```bash
cd example
npm start
```

2. 在页面顶部找到性能测试控制面板

3. 勾选"使用大量测试数据"

4. 设置数据量（例如：100个父任务，每个10个子任务）

5. 点击"重新加载数据"按钮

6. 观察控制台输出的加载时间和任务数量

### 测试建议

#### 渐进式测试
1. 从小数据量开始（100个任务）
2. 逐步增加到中等规模（1000个任务）
3. 测试大规模场景（5000个任务）
4. 如果性能允许，尝试超大规模（10000+任务）

#### 性能指标关注点
- **数据加载时间**：控制台会输出加载耗时
- **渲染性能**：观察页面响应速度
- **滚动流畅度**：测试大数据量下的滚动性能
- **交互延迟**：测试拖拽、编辑等操作的响应速度
- **内存占用**：使用浏览器开发者工具监控内存使用

## 生成数据的特点

每个生成的任务包含：
- ✅ 真实的任务ID和编号
- ✅ 随机的项目分类
- ✅ 随机的任务状态和优先级
- ✅ 合理的时间范围（父任务包含子任务）
- ✅ 根据状态自动计算的进度
- ✅ 随机分配的负责人和监督人
- ✅ 已完成任务的完成时间
- ✅ 处理中任务的延期天数（如果超期）

## 数据量示例

| 配置 | 父任务 | 子任务/父 | 总任务数 | 适用场景 |
|------|--------|----------|---------|---------|
| 小   | 10     | 9        | 100     | 功能验证 |
| 中   | 100    | 9        | 1000    | 常规测试 |
| 大   | 500    | 9        | 5000    | 压力测试 |
| 超大 | 1000   | 10       | 11000   | 极限测试 |

## 性能优化建议

如果在测试中发现性能瓶颈，可以考虑：

1. **虚拟化渲染**：只渲染可见区域的任务
2. **懒加载子任务**：折叠时不渲染子任务
3. **优化重渲染**：使用 React.memo 和 useMemo
4. **防抖节流**：优化滚动和拖拽事件处理
5. **数据缓存**：缓存计算结果避免重复计算
6. **Web Worker**：将数据处理移到后台线程

## 技术实现细节

### 数据生成算法
- 使用时间戳避免ID冲突（从20000开始）
- 子任务时间在父任务范围内分布
- 根据状态代码自动生成合理的进度和完成时间
- 已完成任务自动设置完成时间
- 处理中任务根据截止日期计算延期天数

### 状态映射
```typescript
1: 待確認 (rgb(255,192,0))
2: 處理中 (blue)
3: 待驗收 (#98FB98)
4: 已完成 (#008000)
5: 掛起中 (gray)
```

### 优先级映射
```typescript
1: 低 (#9a9a9a)
2: 中 (#3cb371)
3: 高 (#ff6a6a)
```

## 文件清单

- ✅ `example/src/helper.tsx` - 数据生成逻辑
- ✅ `example/src/App.tsx` - UI控制面板
- ✅ `PERFORMANCE_TEST_GUIDE.md` - 详细测试指南
- ✅ `PERFORMANCE_UPDATE.md` - 本更新说明

## 兼容性

- ✅ 不影响现有功能
- ✅ 默认使用原有的真实数据
- ✅ 可以随时切换回真实数据
- ✅ 不会保存测试数据（刷新重置）

## 下一步

1. 运行示例应用测试功能
2. 进行不同数据量级的性能测试
3. 使用浏览器开发者工具分析性能瓶颈
4. 根据测试结果进行针对性优化

## 快速测试命令

```bash
# 安装依赖（如果还没安装）
cd example
npm install

# 启动开发服务器
npm start

# 在浏览器中打开 http://localhost:3000
# 使用顶部的控制面板生成测试数据
```

---

**更新日期**: 2026年1月26日
**影响范围**: 仅示例应用，不影响核心库
**向后兼容**: 100%
