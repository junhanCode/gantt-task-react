# 性能测试指南

本指南介绍如何使用大量假数据测试甘特图组件的性能表现。

## 功能说明

已在示例应用程序中添加了性能测试数据生成功能，可以快速生成大量假数据来测试组件在高负载下的表现。

## 使用方法

### 1. 启动示例应用

```bash
cd example
npm install
npm start
```

### 2. 使用性能测试控制面板

在应用顶部会看到一个灰色的控制面板，包含以下选项：

- **使用大量测试数据**: 勾选此选项启用大数据模式
- **父任务数**: 设置要生成的父任务数量（1-1000）
- **每个父任务的子任务数**: 设置每个父任务下的子任务数量（0-50）
- **重新加载数据**: 点击此按钮应用新的数据配置

### 3. 推荐的测试场景

#### 小规模测试（100个任务）
- 父任务数: 10
- 子任务数: 9
- 总任务数: 100

适合初步验证功能和性能基准。

#### 中等规模测试（1000个任务）
- 父任务数: 100
- 子任务数: 9
- 总任务数: 1000

适合测试正常业务场景下的性能表现。

#### 大规模测试（5000个任务）
- 父任务数: 500
- 子任务数: 9
- 总任务数: 5000

适合压力测试，检验组件极限性能。

#### 超大规模测试（10000+个任务）
- 父任务数: 1000
- 子任务数: 10
- 总任务数: 11000

适合极端场景测试。

## 性能指标观察

### 1. 数据加载时间

点击"重新加载数据"按钮后，控制台会输出数据加载时间：

```
🚀 生成大量测试数据：100 个父任务，每个 10 个子任务，共 1100 个任务
数据加载时间: 123.45ms
```

### 2. 渲染性能

观察以下指标：
- 首次渲染时间
- 滚动流畅度
- 交互响应速度（拖拽、缩放等）
- 内存占用

### 3. 使用浏览器开发者工具

#### Chrome DevTools Performance
1. 打开 DevTools (F12)
2. 切换到 Performance 标签
3. 点击录制按钮
4. 执行操作（如加载数据、滚动、拖拽）
5. 停止录制并分析结果

#### Memory 分析
1. 打开 DevTools Memory 标签
2. 拍摄堆快照
3. 加载不同数量的数据
4. 对比内存使用情况

## 生成的数据特点

生成的测试数据包含：

- **随机状态**: 待确认、处理中、待验收、已完成、挂起中
- **随机优先级**: 低、中、高
- **随机时间范围**: 过去30天到未来30天之间
- **随机进度**: 根据状态自动计算合理的进度值
- **随机负责人**: 从预设的员工列表中随机分配
- **真实的时间关系**: 子任务时间在父任务时间范围内

## 性能优化建议

如果发现性能问题，可以考虑以下优化方向：

1. **虚拟滚动**: 只渲染可见区域的任务
2. **懒加载**: 按需加载子任务
3. **数据缓存**: 缓存计算结果
4. **防抖/节流**: 优化频繁触发的事件处理
5. **Web Worker**: 将数据处理移到后台线程
6. **React.memo**: 优化组件重渲染

## 代码结构

### 数据生成函数

位置: `example/src/helper.tsx`

```typescript
// 生成大量假数据
generateLargeMockData(parentCount: number, childrenPerParent: number): MockTask[]

// 初始化任务（支持大数据模式）
initTasks(useLargeData: boolean, parentCount: number, childrenPerParent: number): Task[]
```

### 控制面板

位置: `example/src/App.tsx`

包含数据量配置和重新加载功能。

## 注意事项

1. **浏览器限制**: 超大数据量可能导致浏览器卡顿或崩溃
2. **内存占用**: 建议逐步增加数据量，观察内存使用情况
3. **测试环境**: 在生产环境之前充分测试性能
4. **数据持久化**: 测试数据不会被保存，刷新页面会重置

## 性能基准参考

以下是参考性能指标（具体数值取决于硬件配置）：

| 任务数量 | 数据加载时间 | 首次渲染时间 | 内存占用 |
|---------|-------------|-------------|---------|
| 100     | < 50ms      | < 500ms     | ~20MB   |
| 1000    | < 200ms     | < 1s        | ~50MB   |
| 5000    | < 1s        | < 3s        | ~150MB  |
| 10000   | < 2s        | < 5s        | ~300MB  |

## 反馈问题

如果发现性能问题或异常，请记录以下信息：

- 任务数量配置
- 浏览器版本
- 操作系统
- 具体操作步骤
- 性能指标截图
- 控制台错误信息

## 示例截图

控制面板界面：

```
🚀 性能测试数据配置 (当前任务数: 1100)
☑ 使用大量测试数据  父任务数: [100]  每个父任务的子任务数: [10]  = 1100 个任务  [重新加载数据]
```

## 常见问题

**Q: 数据量很大时页面无响应怎么办？**
A: 降低数据量，或者等待渲染完成。建议从小数据量开始逐步增加。

**Q: 如何恢复使用真实数据？**
A: 取消勾选"使用大量测试数据"，然后点击"重新加载数据"。

**Q: 生成的数据可以自定义吗？**
A: 可以修改 `helper.tsx` 中的 `generateLargeMockData` 函数来自定义数据生成规则。

**Q: 如何测试特定的数据模式？**
A: 修改 `generateLargeMockData` 函数中的随机逻辑，生成特定模式的数据。
